<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: scratch.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: scratch.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const AWS = require('aws-sdk')
const EventEmitter = require('events').EventEmitter
const Util = require('util')

/**
* Constructs a new AwsSpotter Library
* @constructor
* @arg {AwsSvc#constructOpts} construct - The AWS service IAM credentials
*/
function AwsSpotPricer (opCredentials) {
  EventEmitter.call(this)

  var opsToConfig = {
    region: 'us-east-1',
    apiVersion: 'latest',
    sslEnabled: true
  }

  if (opCredentials &amp;&amp; opCredentials.hasOwnProperty('accessKeyId')) {
    opsToConfig.accessKeyId = opCredentials.accessKeyId
  }

  if (opCredentials &amp;&amp; opCredentials.hasOwnProperty('secretAccessKey')) {
    opsToConfig.secretAccessKey = opCredentials.secretAccessKey
  }

  this._ec2Service = new AWS.EC2(opsToConfig)
}
Util.inherits(AwsSpotPricer, EventEmitter)

AwsSpotPricer.prototype.price = function () {
  var self = this
  var instanceTypes = ['m3.medium']  // the vm type e.g. t1.micro
  var now = new Date()
  var future = new Date(now)

  var params = {
    InstanceTypes: instanceTypes,
    ProductDescriptions: ['Linux/UNIX'],
    EndTime: future,
    StartTime: now
  }

  var req = this._ec2Service.describeSpotPriceHistory(params)

  /*
  var writable = require('fs').createWriteStream('file.txt')

  var reader = req.createReadStream()
  reader.pipe(writable, { end: false })
  reader.on('end', function () {
    writable.end('Goodbye\n')
  })
  */

  req.on('error', function (err, data) {
    process.nextTick(function emitNextTick () {
      this.emit('done', err)
    }.bind(self))
  })

  req.on('success', function (response) {
    var data = response.data
    var error = null

    if (!(data &amp;&amp; data.hasOwnProperty('SpotPriceHistory'))) {
      error = new Error('data missing')
      data = null
    }

    process.nextTick(function emitNextTick () {
      this.emit('done', error, data)
    }.bind(self))
  })

  req.send()
}

var credentials = {}
if (process.argv.length === 4) {
  credentials.accessKeyId = process.argv[2]
  credentials.secretAccessKey = process.argv[3]
}

var spotter = new AwsSpotPricer(credentials)

spotter.once('done', function (err, data) {
  console.info('price -> err: ', err,
    data ? 'data: ' + data : '')

  process.exit()
})

spotter.price()
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-AwsSpotter.html">AwsSpotter</a></li><li><a href="module-AwsSvc.html">AwsSvc</a></li><li><a href="module-Intern.html">Intern</a></li></ul><h3>Classes</h3><ul><li><a href="AwsSpotPricer.html">AwsSpotPricer</a></li><li><a href="AwsSpotter.html">AwsSpotter</a></li><li><a href="AwsSvc.html">AwsSvc</a></li></ul><h3>Events</h3><ul><li><a href="AwsSpotter.html#event:initialized">initialized</a></li><li><a href="AwsSpotter.html#event:launched">launched</a></li><li><a href="AwsSpotter.html#event:priced">priced</a></li><li><a href="AwsSvc.html#event:complete">complete</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.2</a> on Sat Sep 26 2015 20:59:27 GMT-0300 (CLT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
